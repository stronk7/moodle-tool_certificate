define(["jquery","core/yui","core/fragment","tool_certificate/dialogue","core/notification","core/str","core/templates","core/ajax","tool_wp/modal_form"],function(a,b,c,d,e,f,g,h,i){var j=function(b){this._node=a(b),this._setEvents()};return j.prototype.CUSTOMCERT_REF_POINT_TOPLEFT=0,j.prototype.CUSTOMCERT_REF_POINT_TOPCENTER=1,j.prototype.CUSTOMCERT_REF_POINT_TOPRIGHT=2,j.prototype.PIXELSINMM=3.779527559055,j.prototype._editElement=function(b){var c=a(b.currentTarget).attr("data-id"),d=new i({formClass:"tool_certificate\\edit_element_form",args:this._getPosition(c),modalConfig:{title:f.get_string("editelement","tool_certificate",a(b.currentTarget).attr("data-name"))},saveButtonText:f.get_string("save"),triggerElement:a(b.currentTarget)});d.onSubmitSuccess=function(b){var d=a("#element-"+c),e=parseInt(b.refpoint),f="";e===this.CUSTOMCERT_REF_POINT_TOPLEFT?f="refpoint-left":e===this.CUSTOMCERT_REF_POINT_TOPCENTER?f="refpoint-center":e===this.CUSTOMCERT_REF_POINT_TOPRIGHT&&(f="refpoint-right"),d.html(b.html),d.removeClass(),d.addClass("element "+f),d.attr("data-refpoint",e),d.attr("data-name",b.name),this._setPosition(c,e,parseInt(b.posx),parseInt(b.posy))}.bind(this)},j.prototype._setEvents=function(){this._node.on("click",'[data-action="editelement"]',this._editElement.bind(this))},j.prototype._getPosition=function(b){var c=a("#element-"+b),d=a("#pdf"),e=c.position().left-d.position().left,f=c.position().top-d.position().top,g=parseInt(c.attr("data-refpoint")),h=parseFloat(c.width());switch(g){case this.CUSTOMCERT_REF_POINT_TOPCENTER:e+=h/2;break;case this.CUSTOMCERT_REF_POINT_TOPRIGHT:e+=h}return{posx:Math.round(parseFloat(e/this.PIXELSINMM)),posy:Math.round(parseFloat(f/this.PIXELSINMM)),id:b}},j.prototype._setPosition=function(b,c,d,e){var f=a("#element-"+b);d=a("#pdf").position().left+d*this.PIXELSINMM,e=a("#pdf").position().top+e*this.PIXELSINMM;var g=parseFloat(f.width());switch(c){case this.CUSTOMCERT_REF_POINT_TOPCENTER:d-=g/2;break;case this.CUSTOMCERT_REF_POINT_TOPRIGHT:d=d-g+2}f.css({top:e+"px",left:d+"px"})},{init:function(a){new j(a)}}});