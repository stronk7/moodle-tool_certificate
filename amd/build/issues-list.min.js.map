{"version":3,"sources":["../src/issues-list.js"],"names":["define","$","ModalForm","Notification","Str","Ajax","Toast","SELECTORS","ADDISSUE","REGENERATEFILE","REVOKEISSUE","addIssue","e","preventDefault","modal","formClass","args","tid","currentTarget","attr","modalConfig","title","get_string","saveButtonText","triggerElement","onSubmitSuccess","data","parseInt","get_strings","key","component","param","done","s","str","add","window","location","reload","revokeIssue","stopPropagation","confirm","promises","call","methodname","id","fail","exception","regenerateIssueFile","init","on"],"mappings":"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","sourcesContent":["// This file is part of the tool_certificate plugin for Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module used when viewing the list of issued certificates\n *\n * @module     tool_certificate/issues-list\n * @package    tool_certificate\n * @copyright  2019 Marina Glancy\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery',\n        'tool_certificate/modal_form',\n        'core/notification',\n        'core/str',\n        'core/ajax',\n        'core/toast'],\nfunction($,\n         ModalForm,\n         Notification,\n         Str,\n         Ajax,\n         Toast) {\n\n    const SELECTORS = {\n        ADDISSUE: \"[data-element='addbutton']\",\n        REGENERATEFILE: \"[data-action='regenerate']\",\n        REVOKEISSUE: \"[data-action='revoke']\"\n    };\n\n    /**\n     * Add issue dialogue\n     * @param {Event} e\n     */\n    var addIssue = function(e) {\n        e.preventDefault();\n        var modal = new ModalForm({\n            formClass: 'tool_certificate\\\\form\\\\certificate_issues',\n            args: {tid: $(e.currentTarget).attr('data-tid')},\n            modalConfig: {title: Str.get_string('issuecertificates', 'tool_certificate')},\n            saveButtonText: Str.get_string('save'),\n            triggerElement: $(e.currentTarget),\n        });\n        modal.onSubmitSuccess = function(data) {\n            data = parseInt(data, 10);\n            if (data) {\n                Str.get_strings([\n                    {key: 'oneissuewascreated', component: 'tool_certificate'},\n                    {key: 'aissueswerecreated', component: 'tool_certificate', param: data}\n                ]).done(function(s) {\n                    var str = data > 1 ? s[1] : s[0];\n                    Toast.add(str);\n                });\n                window.location.reload();\n            } else {\n                Str.get_string('noissueswerecreated', 'tool_certificate')\n                    .done(function(s) {\n                        Toast.add(s);\n                    });\n            }\n        };\n    };\n\n    /**\n     * Revoke issue\n     * @param {Event} e\n     */\n    var revokeIssue = function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        Str.get_strings([\n            {key: 'confirm'},\n            {key: 'revokecertificateconfirm', component: 'tool_certificate'},\n            {key: 'revoke', component: 'tool_certificate'},\n            {key: 'cancel'}\n        ]).done(function(s) {\n            Notification.confirm(s[0], s[1], s[2], s[3], function() {\n                var promises = Ajax.call([\n                    {methodname: 'tool_certificate_revoke_issue',\n                        args: {id: $(e.currentTarget).attr('data-id')}}\n                ]);\n                promises[0].done(function() {\n                    window.location.reload();\n                }).fail(Notification.exception);\n            });\n        }).fail(Notification.exception);\n    };\n\n    /**\n     * Revoke issue\n     * @param {Event} e\n     */\n    var regenerateIssueFile = function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        Str.get_strings([\n            {key: 'confirm'},\n            {key: 'regeneratefileconfirm', component: 'tool_certificate'},\n            {key: 'regenerate', component: 'tool_certificate'},\n            {key: 'cancel'}\n        ]).done(function(s) {\n            Notification.confirm(s[0], s[1], s[2], s[3], function() {\n                var promises = Ajax.call([\n                    {methodname: 'tool_certificate_regenerate_issue_file',\n                        args: {id: $(e.currentTarget).attr('data-id')}}\n                ]);\n                promises[0].done(function() {\n                    window.location.reload();\n                }).fail(Notification.exception);\n            });\n        }).fail(Notification.exception);\n    };\n\n    return {\n        /**\n         * Init page\n         */\n        init: function() {\n            // Add button is not inside a tab, so we can't use Tab.addButtonOnClick .\n            $('body')\n                .on('click', SELECTORS.ADDISSUE, addIssue)\n                .on('click', SELECTORS.REVOKEISSUE, revokeIssue)\n                .on('click', SELECTORS.REGENERATEFILE, regenerateIssueFile);\n        }\n    };\n});\n"],"file":"issues-list.min.js"}