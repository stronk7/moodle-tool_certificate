define ("tool_certificate/template-edit",["jquery","tool_wp/modal_form","core/notification","core/str","core/ajax","core/sortable_list"],function(a,b,c,d,f,g){var h=function(c){c.preventDefault();var e=a(c.currentTarget),f=e.attr("data-id"),g=e.attr("data-name"),h=new b({formClass:"tool_certificate\\form\\details",args:{id:f},modalConfig:{title:d.get_string("editcertificate","tool_certificate",g)},saveButtonText:d.get_string("save"),triggerElement:e});h.onSubmitSuccess=function(){window.location.reload()}},i=function(b){b.preventDefault();d.get_strings([{key:"confirm"},{key:"deleteelementconfirm",component:"tool_certificate",param:a(b.currentTarget).attr("data-name")},{key:"delete"},{key:"cancel"}]).done(function(d){c.confirm(d[0],d[1],d[2],d[3],function(){var d=f.call([{methodname:"tool_certificate_delete_element",args:{id:a(b.currentTarget).attr("data-id")}}]);d[0].done(function(){window.location.reload()}).fail(c.exception)})}).fail(c.exception)},j=function(c){c.preventDefault();if(a(c.currentTarget).hasClass("isdragged")){return}var e=new b({formClass:"tool_certificate\\edit_element_form",args:{id:a(c.currentTarget).attr("data-id")},modalConfig:{title:d.get_string("editelement","tool_certificate",a(c.currentTarget).attr("data-name"))},saveButtonText:d.get_string("save"),triggerElement:a(c.currentTarget)});e.onSubmitSuccess=function(){window.location.reload()}},k=function(c){c.preventDefault();var e=a(c.currentTarget).attr("data-pageid"),f=a(c.currentTarget).attr("data-element"),g=new b({formClass:"tool_certificate\\edit_element_form",args:{pageid:e,element:f},modalConfig:{title:d.get_string("addelement","tool_certificate")},saveButtonText:d.get_string("save"),triggerElement:a(c.currentTarget)});g.onSubmitSuccess=function(){window.location.reload()}},l=function(b){b.preventDefault();d.get_strings([{key:"confirm",component:"moodle"},{key:"deletepageconfirm",component:"tool_certificate"},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(d){c.confirm(d[0],d[1],d[2],d[3],function(){window.location.href=a(b.currentTarget).attr("href")})}).fail(c.exception)},m=function(c){c.preventDefault();var e=new b({formClass:"tool_certificate\\form\\page",args:{templateid:a("[data-region=\"template\"][data-id]").attr("data-id")},modalConfig:{title:d.get_string("addcertpage","tool_certificate")},saveButtonText:d.get_string("save"),triggerElement:a(c.currentTarget)});e.onSubmitSuccess=function(){window.location.reload()}},n=function(c){c.preventDefault();var e=new b({formClass:"tool_certificate\\form\\page",args:{id:a(c.currentTarget).attr("data-id")},modalConfig:{title:d.get_string("editpage","tool_certificate",a(c.currentTarget).attr("data-pagenumber"))},saveButtonText:d.get_string("save"),triggerElement:a(c.currentTarget)});e.onSubmitSuccess=function(){window.location.reload()}},o=function(){a("[data-region=\"page\"]").each(function(){var b=new g(a(this).find("[data-region=\"elementlist\"]"));b.getElementName=function(b){return a.Deferred().resolve(b.find("a.quickeditlink").text())};a(this).on(g.EVENTS.DROP,"[data-region=\"elementlist\"] > *",function(a,b){if(b.positionChanged){var d={methodname:"tool_certificate_update_element",args:{id:b.element.data("id"),sequence:b.element.index()+1}};f.call([d])[0].fail(c.exception)}})})},p=function(a){return 2*parseFloat(a)},q=function(a){return Math.round(parseFloat(a)/2)},r=function(a){return .352778*p(a)},s=function(){var b=a(this);b.css("width",p(b.data("pagewidth"))+"px");b.css("height",p(b.data("pageheight"))+"px");b.find("[data-width]").each(function(){a(this).css("width",p(a(this).data("width"))+"px")});b.find("[data-height]").each(function(){a(this).css("height",p(a(this).data("height"))+"px")});b.find("[data-fontsize]").each(function(){a(this).css("font-size",r(a(this).data("fontsize"))+"px")});b.find("[data-posy]").each(function(){a(this).css("top",p(a(this).data("posy"))+"px")});b.find("[data-posx]").each(function(){var b=p(a(this).data("posx")),c=a(this).data("refpoint")?parseInt(a(this).data("refpoint")):0,d=c?parseInt(a(this).width())*c/2:0;a(this).css("left",b-d+"px")});b.addClass("recalculated");b.find("[data-drag-type=\"move\"]").draggable()},t=function(){a("body").on("mousedown","[data-region=\"pdf\"] [data-drag-type=\"move\"]",function(b){var c=a(b.currentTarget),d=c.closest("[data-region=\"pdf\"]");d.find("[data-region=\"pagecenter\"]").css("left",p(d.data("pagecentre"))-c.width()/2+"px").css("width",c.width()+"px");c.draggable({snap:b.shiftKey?!1:".snapdraggable",snapMode:"inner",snapTolerance:10,containment:[d.offset().left-c.width(),d.offset().top-c.height(),d.offset().left+p(d.data("pagewidth")),d.offset().top+p(d.data("pageheight"))]})}).on("dragstart","[data-region=\"pdf\"] [data-drag-type=\"move\"]",function(b){a(b.currentTarget).addClass("isdragged")}).on("dragstop","[data-region=\"pdf\"] [data-drag-type=\"move\"]",function(b){var d=a(b.currentTarget),e=d.closest("[data-region=\"pdf\"]"),g=parseInt(a(this).data("refpoint")),h=g?parseInt(a(this).width())*g/2:0,i=q(d.offset().left-e.offset().left+h),j=q(d.offset().top-e.offset().top);setTimeout(function(){d.removeClass("isdragged")},100);var k={methodname:"tool_certificate_update_element",args:{id:d.data("id"),posx:i,posy:j}};f.call([k])[0].fail(c.exception)})};return{init:function init(){a("[data-action=\"editdetails\"]").on("click",h);a("[data-action=\"deleteelement\"]").on("click",i);a("[data-action=\"editelement\"]").on("click",j);a("[data-action=\"addelement\"]").on("click",k);a("[data-action=\"deletepage\"]").on("click",l);a("[data-element=\"addbutton\"]").on("click",m);a("[data-action=\"editpage\"]").on("click",n);o();t();a("[data-region=\"pdf\"]").each(s)}}});
//# sourceMappingURL=template-edit.min.js.map
