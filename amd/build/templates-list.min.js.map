{"version":3,"sources":["../src/templates-list.js"],"names":["define","$","ModalForm","Notification","Str","Ajax","WpNotification","displayModal","triggerElement","title","args","modal","formClass","modalConfig","saveButtonText","get_string","displayAddTemplate","e","contextid","currentTarget","data","preventDefault","id","onSubmitSuccess","url","window","location","href","displayEditTemplate","el","attr","name","reload","displayIssue","target","tid","parseInt","get_strings","key","component","param","done","s","str","addNotification","message","type","duplicateMulticategory","templateId","duplicateSinglecategory","confirm","promises","call","methodname","fail","exception","deleteTemplate","init","on"],"mappings":"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","sourcesContent":["// This file is part of the tool_certificate plugin for Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module used when viewing the list of templates\n *\n * @module     tool_certificate/templates-list\n * @package    tool_certificate\n * @copyright  2019 Marina Glancy\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'tool_wp/modal_form', 'core/notification', 'core/str', 'core/ajax', 'tool_wp/notification'],\nfunction($, ModalForm, Notification, Str, Ajax, WpNotification) {\n\n    /**\n     * Display modal form\n     *\n     * @param {jQuery} triggerElement\n     * @param {String} title\n     * @param {Object} args\n     * @return {ModalForm}\n     */\n    var displayModal = function(triggerElement, title, args) {\n        var modal = new ModalForm({\n            formClass: 'tool_certificate\\\\form\\\\details',\n            args: args,\n            modalConfig: {title: title},\n            saveButtonText: Str.get_string('save'),\n            triggerElement: triggerElement,\n        });\n        return modal;\n    };\n\n    /**\n     * Add template dialogue\n     * @param {Event} e\n     */\n    var displayAddTemplate = function(e) {\n        var contextid = $(e.currentTarget).data('contextid');\n        e.preventDefault();\n        var modal = displayModal($(e.currentTarget), Str.get_string('createtemplate', 'tool_certificate'),\n            {id: 0, contextid: contextid});\n        modal.onSubmitSuccess = function(url) {\n            window.location.href = url;\n        };\n    };\n\n    /**\n     * Edit template dialogue\n     * @param {Event} e\n     */\n    var displayEditTemplate = function(e) {\n        e.preventDefault();\n        var el = $(e.currentTarget),\n            id = el.attr('data-id'),\n            name = el.attr('data-name');\n        var modal = displayModal(el, Str.get_string('editcertificate', 'tool_certificate', name), {id: id});\n        modal.onSubmitSuccess = function() {\n            window.location.reload();\n        };\n    };\n\n    /**\n     * Add template dialogue\n     * @param {Event} e\n     */\n    var displayIssue = function(e) {\n        e.preventDefault();\n        const target = $(e.currentTarget);\n        var modal = new ModalForm({\n            formClass: 'tool_certificate\\\\form\\\\certificate_issues',\n            args: {tid: target.attr('data-tid')},\n            modalConfig: {title: Str.get_string('issuecertificates', 'tool_certificate')},\n            saveButtonText: Str.get_string('save'),\n            triggerElement: target,\n        });\n        modal.onSubmitSuccess = function(data) {\n            data = parseInt(data, 10);\n            if (data) {\n                Str.get_strings([\n                    {key: 'oneissuewascreated', component: 'tool_certificate'},\n                    {key: 'aissueswerecreated', component: 'tool_certificate', param: data}\n                ]).done(function(s) {\n                    var str = data > 1 ? s[1] : s[0];\n                    WpNotification.addNotification({message: str, type: 'success'});\n                });\n            } else {\n                Str.get_string('noissueswerecreated', 'tool_certificate')\n                    .done(function(s) {\n                        WpNotification.addNotification({message: s, type: 'warning'});\n                    });\n            }\n        };\n    };\n\n    var duplicateMulticategory = function(e) {\n        e.preventDefault();\n        const target = $(e.currentTarget);\n        const templateId = target.attr('data-id');\n        var modal = new ModalForm({\n            formClass: 'tool_certificate\\\\form\\\\category_selector',\n            args: {id: templateId},\n            modalConfig: {title: Str.get_string('confirm')},\n            saveButtonText: Str.get_string('duplicate', 'tool_certificate'),\n            triggerElement: target,\n        });\n        modal.onSubmitSuccess = function() {\n            window.location.reload();\n        };\n    };\n\n    var duplicateSinglecategory = function(e) {\n        e.preventDefault();\n        const templateId = $(e.currentTarget).attr('data-id');\n        Str.get_strings([\n            {key: 'confirm'},\n            {key: 'duplicatetemplateconfirm', component: 'tool_certificate', param: $(e.currentTarget).attr('data-name')},\n            {key: 'duplicate', component: 'tool_certificate'},\n            {key: 'cancel'}\n        ]).done(function(s) {\n            Notification.confirm(s[0], s[1], s[2], s[3], function() {\n                var promises = Ajax.call([\n                    {methodname: 'tool_certificate_duplicate_template',\n                        args: {id: templateId}}\n                ]);\n                promises[0].done(function() {\n                    window.location.reload();\n                }).fail(Notification.exception);\n            });\n        }).fail(Notification.exception);\n    };\n\n    var deleteTemplate = function(e) {\n        e.preventDefault();\n        const templateId = $(e.currentTarget).attr('data-id');\n        Str.get_strings([\n            {key: 'confirm'},\n            {key: 'deletetemplateconfirm', component: 'tool_certificate', param: $(e.currentTarget).attr('data-name')},\n            {key: 'delete'},\n            {key: 'cancel'}\n        ]).done(function(s) {\n            Notification.confirm(s[0], s[1], s[2], s[3], function() {\n                var promises = Ajax.call([\n                    {methodname: 'tool_certificate_delete_template',\n                        args: {id: templateId}}\n                ]);\n                promises[0].done(function() {\n                    window.location.reload();\n                }).fail(Notification.exception);\n            });\n        }).fail(Notification.exception);\n    };\n\n    return {\n        /**\n         * Init page\n         */\n        init: function() {\n            // Add button is not inside a tab, so we can't use Tab.addButtonOnClick .\n            $('body')\n                .on('click', '[data-element=\"addbutton\"]', displayAddTemplate)\n                .on('click', '[data-action=\"editdetails\"]', displayEditTemplate)\n                .on('click', '[data-action=\"issue\"]', displayIssue)\n                .on('click', '[data-action=\"duplicate\"][data-selectcategory=\"1\"]', duplicateMulticategory)\n                .on('click', '[data-action=\"duplicate\"][data-selectcategory=\"0\"]', duplicateSinglecategory)\n                .on('click', '[data-action=\"delete\"]', deleteTemplate);\n        }\n    };\n});\n\n"],"file":"templates-list.min.js"}