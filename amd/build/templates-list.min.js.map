{"version":3,"sources":["../src/templates-list.js"],"names":["define","$","ModalForm","Tabs","Notification","Str","Ajax","displayModal","triggerElement","title","id","modal","formClass","args","modalConfig","saveButtonText","get_string","displayAddTemplate","e","preventDefault","currentTarget","onSubmitSuccess","url","window","location","href","displayEditTemplate","el","attr","name","reload","displayIssue","tid","duplicateMultitenant","duplicateSingletenant","get_strings","key","component","param","done","s","confirm","promises","call","methodname","fail","exception","deleteTemplate","init","on"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module used when viewing the list of templates\n *\n * @module     tool_certificate/templates-list\n * @package    tool_certificate\n * @copyright  2019 Marina Glancy\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'tool_wp/modal_form', 'tool_wp/tabs', 'core/notification', 'core/str', 'core/ajax'],\nfunction($, ModalForm, Tabs, Notification, Str, Ajax) {\n\n    /**\n     * Display modal form\n     *\n     * @param {jQuery} triggerElement\n     * @param {String} title\n     * @param {Number} id\n     * @return {ModalForm}\n     */\n    var displayModal = function(triggerElement, title, id) {\n        var modal = new ModalForm({\n            formClass: 'tool_certificate\\\\form\\\\details',\n            args: {id: id},\n            modalConfig: {title: title},\n            saveButtonText: Str.get_string('save'),\n            triggerElement: triggerElement,\n        });\n        return modal;\n    };\n\n    /**\n     * Add template dialogue\n     * @param {Event} e\n     */\n    var displayAddTemplate = function(e) {\n        e.preventDefault();\n        var modal = displayModal($(e.currentTarget), Str.get_string('createtemplate', 'tool_certificate'), 0);\n        modal.onSubmitSuccess = function(url) {\n            window.location.href = url;\n        };\n    };\n\n    /**\n     * Edit template dialogue\n     * @param {Event} e\n     */\n    var displayEditTemplate = function(e) {\n        e.preventDefault();\n        var el = $(e.currentTarget),\n            id = el.attr('data-id'),\n            name = el.attr('data-name');\n        var modal = displayModal(el, Str.get_string('editcertificate', 'tool_certificate', name), id);\n        modal.onSubmitSuccess = function() {\n            window.location.reload();\n        };\n    };\n\n    /**\n     * Add template dialogue\n     * @param {Event} e\n     */\n    var displayIssue = function(e) {\n        e.preventDefault();\n        new ModalForm({\n            formClass: 'tool_certificate\\\\form\\\\certificate_issues',\n            args: {tid: $(e.currentTarget).attr('data-tid')},\n            modalConfig: {title: Str.get_string('issuenewcertificates', 'tool_certificate')},\n            saveButtonText: Str.get_string('save'),\n            triggerElement: $(e.currentTarget),\n        });\n        // No action on submit.\n    };\n\n    var duplicateMultitenant = function(e) {\n        e.preventDefault();\n        var modal = new ModalForm({\n            formClass: 'tool_certificate\\\\form\\\\tenant_selector',\n            args: {id: $(e.currentTarget).attr('data-id')},\n            modalConfig: {title: Str.get_string('confirm')},\n            saveButtonText: Str.get_string('duplicate', 'tool_certificate'),\n            triggerElement: $(e.currentTarget),\n        });\n        modal.onSubmitSuccess = function() {\n            window.location.reload();\n        };\n    };\n\n    var duplicateSingletenant = function(e) {\n        e.preventDefault();\n        Str.get_strings([\n            {key: 'confirm'},\n            {key: 'duplicatetemplateconfirm', component: 'tool_certificate', param: $(e.currentTarget).attr('data-name')},\n            {key: 'duplicate', component: 'tool_certificate'},\n            {key: 'cancel'}\n        ]).done(function(s) {\n            Notification.confirm(s[0], s[1], s[2], s[3], function() {\n                var promises = Ajax.call([\n                    {methodname: 'tool_certificate_duplicate_template',\n                        args: {id: $(e.currentTarget).attr('data-id')}}\n                ]);\n                promises[0].done(function() {\n                    window.location.reload();\n                }).fail(Notification.exception);\n            });\n        }).fail(Notification.exception);\n    };\n\n    var deleteTemplate = function(e) {\n        e.preventDefault();\n        Str.get_strings([\n            {key: 'confirm'},\n            {key: 'deletetemplateconfirm', component: 'tool_certificate', param: $(e.currentTarget).attr('data-name')},\n            {key: 'delete'},\n            {key: 'cancel'}\n        ]).done(function(s) {\n            Notification.confirm(s[0], s[1], s[2], s[3], function() {\n                var promises = Ajax.call([\n                    {methodname: 'tool_certificate_delete_template',\n                        args: {id: $(e.currentTarget).attr('data-id')}}\n                ]);\n                promises[0].done(function() {\n                    window.location.reload();\n                }).fail(Notification.exception);\n            });\n        }).fail(Notification.exception);\n    };\n\n    return {\n        /**\n         * Init page\n         */\n        init: function() {\n            // Add button is not inside a tab, so we can't use Tab.addButtonOnClick .\n            $('[data-tabs-element=\"addbutton\"]').on('click', displayAddTemplate);\n            $('[data-action=\"editdetails\"]').on('click', displayEditTemplate);\n            $('[data-action=\"issue\"]').on('click', displayIssue);\n            $('[data-action=\"duplicate\"][data-selecttenant=\"1\"]').on('click', duplicateMultitenant);\n            $('[data-action=\"duplicate\"][data-selecttenant=\"0\"]').on('click', duplicateSingletenant);\n            $('[data-action=\"delete\"]').on('click', deleteTemplate);\n        }\n    };\n});\n"],"file":"templates-list.min.js"}